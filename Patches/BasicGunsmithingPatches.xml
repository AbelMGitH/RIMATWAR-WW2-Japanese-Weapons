<?xml version="1.0" encoding="utf-8" ?>
<Patch>

    <Operation Class="PatchOperationReplace">
        <xpath>Defs/ResearchProjectDef[defName="Gunsmithing"]/prerequisites</xpath>
        <value>
            <prerequisites>
                <li>HRK_Research_SimpleAssaultRifles</li>
            </prerequisites>
        </value>
    </Operation>

    <Operation Class="PatchOperationReplace">
        <xpath>Defs/ResearchProjectDef[defName="Gunsmithing"]/label</xpath>
        <value>
            <label>modern gunsmithing</label>
        </value>
    </Operation>

    <Operation Class="PatchOperationAdd">
        <xpath>Defs/ResearchProjectDef[defName="PrecisionRifling"]/prerequisites</xpath>
        <value>
            <li>HRK_Research_SimpleOptics</li>
        </value>
    </Operation>

    <Operation Class="PatchOperationAdd">
        <xpath>Defs/ResearchProjectDef[defName="IEDs"]/prerequisites</xpath>
        <value>
            <li>HRK_Research_SimpleFuses</li>
        </value>
    </Operation>

    <!--===== WEAPONS =====-->
    <Operation Class="PatchOperationSequence">
        <operations>

            <!--===== CORE =====-->
            <li Class="PatchOperationReplace">
                <xpath>Defs/ThingDef[defName="Gun_Autopistol"]/recipeMaker/researchPrerequisite</xpath>
                <value>
                    <researchPrerequisite>HRK_Research_SimpleAutomaticDesigns</researchPrerequisite>
                </value>
            </li>

            <li Class="PatchOperationConditional">
                <xpath>Defs/ThingDef[defName="Gun_Autopistol"]/recipeMaker/recipeUsers</xpath>
                <match Class="PatchOperationReplace">
                    <xpath>Defs/ThingDef[defName="Gun_Autopistol"]/recipeMaker/recipeUsers</xpath>
                    <value>
                        <recipeUsers>
                            <li>FueledSmithy</li>
                            <li>ElectricSmithy</li>
                            <li>TableMachining</li>
                        </recipeUsers>
                    </value>
                </match>
                <nomatch Class="PatchOperationAdd">
                    <xpath>Defs/ThingDef[defName="Gun_Autopistol"]/recipeMaker</xpath>
                    <value>
                        <recipeUsers>
                            <li>FueledSmithy</li>
                            <li>ElectricSmithy</li>
                            <li>TableMachining</li>
                        </recipeUsers>
                    </value>
                </nomatch>
            </li>

            <li Class="PatchOperationReplace">
                <xpath>Defs/ThingDef[defName="Gun_BoltActionRifle"]/recipeMaker/researchPrerequisite</xpath>
                <value>
                    <researchPrerequisite>HRK_Research_SimpleGunsmithing</researchPrerequisite>
                </value>
            </li>

            <li Class="PatchOperationConditional">
                <xpath>Defs/ThingDef[defName="Gun_BoltActionRifle"]/recipeMaker/recipeUsers</xpath>
                <match Class="PatchOperationReplace">
                    <xpath>Defs/ThingDef[defName="Gun_BoltActionRifle"]/recipeMaker/recipeUsers</xpath>
                    <value>
                        <recipeUsers>
                            <li>FueledSmithy</li>
                            <li>ElectricSmithy</li>
                            <li>TableMachining</li>
                        </recipeUsers>
                    </value>
                </match>
                <nomatch Class="PatchOperationAdd">
                    <xpath>Defs/ThingDef[defName="Gun_BoltActionRifle"]/recipeMaker</xpath>
                    <value>
                        <recipeUsers>
                            <li>FueledSmithy</li>
                            <li>ElectricSmithy</li>
                            <li>TableMachining</li>
                        </recipeUsers>
                    </value>
                </nomatch>
            </li>

            <li Class="PatchOperationReplace">
                <xpath>Defs/ThingDef[defName="Gun_LMG"]/recipeMaker/researchPrerequisite</xpath>
                <value>
                    <researchPrerequisite>HRK_Research_SimpleAssaultRifles</researchPrerequisite>
                </value>
            </li>

            <li Class="PatchOperationConditional">
                <xpath>Defs/ThingDef[defName="Gun_LMG"]/recipeMaker/recipeUsers</xpath>
                <match Class="PatchOperationReplace">
                    <xpath>Defs/ThingDef[defName="Gun_LMG"]/recipeMaker/recipeUsers</xpath>
                    <value>
                        <recipeUsers>
                            <li>FueledSmithy</li>
                            <li>ElectricSmithy</li>
                            <li>TableMachining</li>
                        </recipeUsers>
                    </value>
                </match>
                <nomatch Class="PatchOperationAdd">
                    <xpath>Defs/ThingDef[defName="Gun_LMG"]/recipeMaker</xpath>
                    <value>
                        <recipeUsers>
                            <li>FueledSmithy</li>
                            <li>ElectricSmithy</li>
                            <li>TableMachining</li>
                        </recipeUsers>
                    </value>
                </nomatch>
            </li>

            <!--===== CE GUNS =====-->
            <li Class="PatchOperationConditional" MayRequire="CETeam.CombatExtendedGuns">
                <xpath>Defs/ThingDef[defName="CE_Gun_WinchesterNintyFour"]/recipeMaker/researchPrerequisite</xpath>
                <match Class="PatchOperationReplace">
                    <xpath>Defs/ThingDef[defName="CE_Gun_WinchesterNintyFour"]/recipeMaker/researchPrerequisite</xpath>
                    <value>
                        <researchPrerequisite>HRK_Research_SimpleGunsmithing</researchPrerequisite>
                    </value>
                </match>
            </li>

            <li Class="PatchOperationConditional" MayRequire="CETeam.CombatExtendedGuns">
                <xpath>Defs/ThingDef[defName="CE_Gun_WinchesterNintyFour"]/recipeMaker/recipeUsers</xpath>
                <match Class="PatchOperationReplace">
                    <xpath>Defs/ThingDef[defName="CE_Gun_WinchesterNintyFour"]/recipeMaker/recipeUsers</xpath>
                    <value>
                        <recipeUsers>
                            <li>FueledSmithy</li>
                            <li>ElectricSmithy</li>
                            <li>TableMachining</li>
                        </recipeUsers>
                    </value>
                </match>
                <nomatch Class="PatchOperationAdd">
                    <xpath>Defs/ThingDef[defName="CE_Gun_WinchesterNintyFour"]/recipeMaker</xpath>
                    <value>
                        <recipeUsers>
                            <li>FueledSmithy</li>
                            <li>ElectricSmithy</li>
                            <li>TableMachining</li>
                        </recipeUsers>
                    </value>
                </nomatch>
            </li>

            <li Class="PatchOperationConditional" MayRequire="CETeam.CombatExtendedGuns">
                <xpath>Defs/ThingDef[defName="CE_Gun_PTRS"]/recipeMaker/researchPrerequisite</xpath>
                <match Class="PatchOperationReplace">
                    <xpath>Defs/ThingDef[defName="CE_Gun_PTRS"]/recipeMaker/researchPrerequisite</xpath>
                    <value>
                        <researchPrerequisite>HRK_Research_SimpleAutomaticDesigns</researchPrerequisite>
                    </value>
                </match>
            </li>

            <li Class="PatchOperationConditional" MayRequire="CETeam.CombatExtendedGuns">
                <xpath>Defs/ThingDef[defName="CE_Gun_PTRS"]/recipeMaker/recipeUsers</xpath>
                <match Class="PatchOperationReplace">
                    <xpath>Defs/ThingDef[defName="CE_Gun_PTRS"]/recipeMaker/recipeUsers</xpath>
                    <value>
                        <recipeUsers>
                            <li>FueledSmithy</li>
                            <li>ElectricSmithy</li>
                            <li>TableMachining</li>
                        </recipeUsers>
                    </value>
                </match>
                <nomatch Class="PatchOperationAdd">
                    <xpath>Defs/ThingDef[defName="CE_Gun_PTRS"]/recipeMaker</xpath>
                    <value>
                        <recipeUsers>
                            <li>FueledSmithy</li>
                            <li>ElectricSmithy</li>
                            <li>TableMachining</li>
                        </recipeUsers>
                    </value>
                </nomatch>
            </li>

            <!--===== CZARsenal =====-->
            <li Class="PatchOperationConditional" MayRequire="CE.Kirp.RUGuns">
                <xpath>Defs/ThingDef[defName="CE_Gun_KripTTRU"]/recipeMaker/researchPrerequisite</xpath>
                <match Class="PatchOperationReplace">
                    <xpath>Defs/ThingDef[defName="CE_Gun_KripTTRU"]/recipeMaker/researchPrerequisite</xpath>
                    <value>
                        <researchPrerequisite>HRK_Research_SimpleAutomaticDesigns</researchPrerequisite>
                    </value>
                </match>
            </li>

            <li Class="PatchOperationConditional" MayRequire="CE.Kirp.RUGuns">
                <xpath>Defs/ThingDef[defName="CE_Gun_KripTTRU"]/recipeMaker/recipeUsers</xpath>
                <match Class="PatchOperationReplace">
                    <xpath>Defs/ThingDef[defName="CE_Gun_KripTTRU"]/recipeMaker/recipeUsers</xpath>
                    <value>
                        <recipeUsers>
                            <li>FueledSmithy</li>
                            <li>ElectricSmithy</li>
                            <li>TableMachining</li>
                        </recipeUsers>
                    </value>
                </match>
                <nomatch Class="PatchOperationAdd">
                    <xpath>Defs/ThingDef[defName="CE_Gun_KripTTRU"]/recipeMaker</xpath>
                    <value>
                        <recipeUsers>
                            <li>FueledSmithy</li>
                            <li>ElectricSmithy</li>
                            <li>TableMachining</li>
                        </recipeUsers>
                    </value>
                </nomatch>
            </li>

            <li Class="PatchOperationConditional" MayRequire="CE.Kirp.RUGuns">
                <xpath>Defs/ThingDef[defName="CE_Gun_Krip_Mosin1891a"]/recipeMaker/researchPrerequisite</xpath>
                <match Class="PatchOperationReplace">
                    <xpath>Defs/ThingDef[defName="CE_Gun_Krip_Mosin1891a"]/recipeMaker/researchPrerequisite</xpath>
                    <value>
                        <researchPrerequisite>HRK_Research_SimpleGunsmithing</researchPrerequisite>
                    </value>
                </match>
            </li>

            <li Class="PatchOperationConditional" MayRequire="CE.Kirp.RUGuns">
                <xpath>Defs/ThingDef[defName="CE_Gun_Krip_Mosin1891a"]/recipeMaker/recipeUsers</xpath>
                <match Class="PatchOperationReplace">
                    <xpath>Defs/ThingDef[defName="CE_Gun_Krip_Mosin1891a"]/recipeMaker/recipeUsers</xpath>
                    <value>
                        <recipeUsers>
                            <li>FueledSmithy</li>
                            <li>ElectricSmithy</li>
                            <li>TableMachining</li>
                        </recipeUsers>
                    </value>
                </match>
                <nomatch Class="PatchOperationAdd">
                    <xpath>Defs/ThingDef[defName="CE_Gun_Krip_Mosin1891a"]/recipeMaker</xpath>
                    <value>
                        <recipeUsers>
                            <li>FueledSmithy</li>
                            <li>ElectricSmithy</li>
                            <li>TableMachining</li>
                        </recipeUsers>
                    </value>
                </nomatch>
            </li>

            <li Class="PatchOperationConditional" MayRequire="CE.Kirp.RUGuns">
                <xpath>Defs/ThingDef[defName="CE_Gun_Krip_Mosin44a"]/recipeMaker/researchPrerequisite</xpath>
                <match Class="PatchOperationReplace">
                    <xpath>Defs/ThingDef[defName="CE_Gun_Krip_Mosin44a"]/recipeMaker/researchPrerequisite</xpath>
                    <value>
                        <researchPrerequisite>HRK_Research_SimpleGunsmithing</researchPrerequisite>
                    </value>
                </match>
            </li>

            <li Class="PatchOperationConditional" MayRequire="CE.Kirp.RUGuns">
                <xpath>Defs/ThingDef[defName="CE_Gun_Krip_Mosin44a"]/recipeMaker/recipeUsers</xpath>
                <match Class="PatchOperationReplace">
                    <xpath>Defs/ThingDef[defName="CE_Gun_Krip_Mosin44a"]/recipeMaker/recipeUsers</xpath>
                    <value>
                        <recipeUsers>
                            <li>FueledSmithy</li>
                            <li>ElectricSmithy</li>
                            <li>TableMachining</li>
                        </recipeUsers>
                    </value>
                </match>
                <nomatch Class="PatchOperationAdd">
                    <xpath>Defs/ThingDef[defName="CE_Gun_Krip_Mosin44a"]/recipeMaker</xpath>
                    <value>
                        <recipeUsers>
                            <li>FueledSmithy</li>
                            <li>ElectricSmithy</li>
                            <li>TableMachining</li>
                        </recipeUsers>
                    </value>
                </nomatch>
            </li>

            <li Class="PatchOperationConditional" MayRequire="CE.Kirp.RUGuns">
                <xpath>Defs/ThingDef[defName="CE_Gun_Krip_Mosin9130s"]/recipeMaker/researchPrerequisite</xpath>
                <match Class="PatchOperationReplace">
                    <xpath>Defs/ThingDef[defName="CE_Gun_Krip_Mosin9130s"]/recipeMaker/researchPrerequisite</xpath>
                    <value>
                        <researchPrerequisite>HRK_Research_SimpleGunsmithing</researchPrerequisite>
                    </value>
                </match>
            </li>

            <li Class="PatchOperationConditional" MayRequire="CE.Kirp.RUGuns">
                <xpath>Defs/ThingDef[defName="CE_Gun_Krip_Mosin9130s"]/recipeMaker/recipeUsers</xpath>
                <match Class="PatchOperationReplace">
                    <xpath>Defs/ThingDef[defName="CE_Gun_Krip_Mosin9130s"]/recipeMaker/recipeUsers</xpath>
                    <value>
                        <recipeUsers>
                            <li>FueledSmithy</li>
                            <li>ElectricSmithy</li>
                            <li>TableMachining</li>
                        </recipeUsers>
                    </value>
                </match>
                <nomatch Class="PatchOperationAdd">
                    <xpath>Defs/ThingDef[defName="CE_Gun_Krip_Mosin9130s"]/recipeMaker</xpath>
                    <value>
                        <recipeUsers>
                            <li>FueledSmithy</li>
                            <li>ElectricSmithy</li>
                            <li>TableMachining</li>
                        </recipeUsers>
                    </value>
                </nomatch>
            </li>

            <li Class="PatchOperationConditional" MayRequire="CE.Kirp.RUGuns">
                <xpath>Defs/ThingDef[defName="CE_Gun_Krip_MosinPU"]/recipeMaker/researchPrerequisite</xpath>
                <match Class="PatchOperationReplace">
                    <xpath>Defs/ThingDef[defName="CE_Gun_Krip_MosinPU"]/recipeMaker/researchPrerequisite</xpath>
                    <value>
                        <researchPrerequisite>HRK_Research_SimpleOptics</researchPrerequisite>
                    </value>
                </match>
            </li>

            <li Class="PatchOperationConditional" MayRequire="CE.Kirp.RUGuns">
                <xpath>Defs/ThingDef[defName="CE_Gun_Krip_MosinPU"]/recipeMaker/recipeUsers</xpath>
                <match Class="PatchOperationReplace">
                    <xpath>Defs/ThingDef[defName="CE_Gun_Krip_MosinPU"]/recipeMaker/recipeUsers</xpath>
                    <value>
                        <recipeUsers>
                            <li>FueledSmithy</li>
                            <li>ElectricSmithy</li>
                            <li>TableMachining</li>
                        </recipeUsers>
                    </value>
                </match>
                <nomatch Class="PatchOperationAdd">
                    <xpath>Defs/ThingDef[defName="CE_Gun_Krip_MosinPU"]/recipeMaker</xpath>
                    <value>
                        <recipeUsers>
                            <li>FueledSmithy</li>
                            <li>ElectricSmithy</li>
                            <li>TableMachining</li>
                        </recipeUsers>
                    </value>
                </nomatch>
            </li>

            <li Class="PatchOperationConditional" MayRequire="CE.Kirp.RUGuns">
                <xpath>Defs/ThingDef[defName="CE_Gun_KripDTMa"]/recipeMaker/researchPrerequisite</xpath>
                <match Class="PatchOperationReplace">
                    <xpath>Defs/ThingDef[defName="CE_Gun_KripDTMa"]/recipeMaker/researchPrerequisite</xpath>
                    <value>
                        <researchPrerequisite>HRK_Research_SimpleAssaultRifles</researchPrerequisite>
                    </value>
                </match>
            </li>

            <li Class="PatchOperationConditional" MayRequire="CE.Kirp.RUGuns">
                <xpath>Defs/ThingDef[defName="CE_Gun_KripDTMa"]/recipeMaker/recipeUsers</xpath>
                <match Class="PatchOperationReplace">
                    <xpath>Defs/ThingDef[defName="CE_Gun_KripDTMa"]/recipeMaker/recipeUsers</xpath>
                    <value>
                        <recipeUsers>
                            <li>FueledSmithy</li>
                            <li>ElectricSmithy</li>
                            <li>TableMachining</li>
                        </recipeUsers>
                    </value>
                </match>
                <nomatch Class="PatchOperationAdd">
                    <xpath>Defs/ThingDef[defName="CE_Gun_KripDTMa"]/recipeMaker</xpath>
                    <value>
                        <recipeUsers>
                            <li>FueledSmithy</li>
                            <li>ElectricSmithy</li>
                            <li>TableMachining</li>
                        </recipeUsers>
                    </value>
                </nomatch>
            </li>

            <li Class="PatchOperationConditional" MayRequire="CE.Kirp.RUGuns">
                <xpath>Defs/ThingDef[defName="CE_Gun_KripDP17a"]/recipeMaker/researchPrerequisite</xpath>
                <match Class="PatchOperationReplace">
                    <xpath>Defs/ThingDef[defName="CE_Gun_KripDP17a"]/recipeMaker/researchPrerequisite</xpath>
                    <value>
                        <researchPrerequisite>HRK_Research_SimpleAssaultRifles</researchPrerequisite>
                    </value>
                </match>
            </li>

            <li Class="PatchOperationConditional" MayRequire="CE.Kirp.RUGuns">
                <xpath>Defs/ThingDef[defName="CE_Gun_KripDP17a"]/recipeMaker/recipeUsers</xpath>
                <match Class="PatchOperationReplace">
                    <xpath>Defs/ThingDef[defName="CE_Gun_KripDP17a"]/recipeMaker/recipeUsers</xpath>
                    <value>
                        <recipeUsers>
                            <li>FueledSmithy</li>
                            <li>ElectricSmithy</li>
                            <li>TableMachining</li>
                        </recipeUsers>
                    </value>
                </match>
                <nomatch Class="PatchOperationAdd">
                    <xpath>Defs/ThingDef[defName="CE_Gun_KripDP17a"]/recipeMaker</xpath>
                    <value>
                        <recipeUsers>
                            <li>FueledSmithy</li>
                            <li>ElectricSmithy</li>
                            <li>TableMachining</li>
                        </recipeUsers>
                    </value>
                </nomatch>
            </li>

        </operations>
    </Operation>

</Patch>