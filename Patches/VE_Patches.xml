<?xml version="1.0" encoding="utf-8" ?>

<Patch>

    <Operation Class="PatchOperationFindMod">
        <mods>
            <li>Combat Extended</li>
        </mods>
        <nomatch Class="PatchOperationSequence">
            <operations>

                <li Class="PatchOperationReplace" MayRequire="VanillaExpanded.VWEG">
                    <xpath>Defs/ThingDef[defName="HRK_Type3Grenade"]/graphicData/texPath</xpath>
                    <value>
                        <texPath>Things/Item/Equipment/WeaponRanged/HRK_Type3GrenadesLoose</texPath>
                    </value>
                </li>

                <li Class="PatchOperationReplace" MayRequire="VanillaExpanded.VWEG">
                    <xpath>Defs/ThingDef[defName="HRK_Type89Grenade"]/graphicData/texPath</xpath>
                    <value>
                        <texPath>Things/Item/Equipment/WeaponRanged/HRK_Type89GrenadesLoose</texPath>
                    </value>
                </li>

                <li Class="PatchOperationReplace" MayRequire="VanillaExpanded.VWEG">
                    <xpath>Defs/ThingDef[defName="HRK_Type97Grenade"]/graphicData/texPath</xpath>
                    <value>
                        <texPath>Things/Item/Equipment/WeaponRanged/HRK_Type97GrenadesLoose</texPath>
                    </value>
                </li>

                <li Class="PatchOperationReplace" MayRequire="VanillaExpanded.VWE">
                    <xpath>Defs/ThingDef[defName="HRK_Type470mmRL"]/recipeMaker/researchPrerequisite</xpath>
                    <value>
                        <researchPrerequisite>VWE_HeavyWeapons</researchPrerequisite>
                    </value>
                </li>

                <li Class="PatchOperationAddModExtension" MayRequire="OskarPotocki.VanillaFactionsExpanded.Core">
                    <xpath>Defs/ThingDef[defName="HRK_Type470mmRL"]</xpath>
                    <value>
                        <li Class="HeavyWeapons.HeavyWeapon">
                            <weaponHitPointsDeductionOnShot>20</weaponHitPointsDeductionOnShot>
                            <isHeavy>false</isHeavy>
                        </li>
                    </value>
                </li>

                <li Class="PatchOperationReplace" MayRequire="OskarPotocki.VanillaFactionsExpanded.Core">
                    <xpath>Defs/ThingDef[defName="HRK_Type470mmRL"]/verbs/li[1]/verbClass</xpath>
                    <value>
                        <verbClass>HeavyWeapons.Verb_Shoot</verbClass>
                    </value>
                </li>

                <li Class="PatchOperationReplace" MayRequire="OskarPotocki.VanillaFactionsExpanded.Core">
                    <xpath>Defs/ThingDef[defName="HRK_Type470mmRL"]/description</xpath>
                    <value>
                        <description>The Type 4 74mm is a Japanese rocket launcher used during the last year of World War II. It is comparable to the German panzerschreck and the American bazooka. \n\nBecause you are using Vanilla Expanded Framework this weapon loses durability with each shot (5 shots in total) to make it more balanced.</description>
                    </value>
                </li>

                <li Class="PatchOperationReplace" MayRequire="OskarPotocki.VanillaFactionsExpanded.Core">
                    <xpath>Defs/ThingDef[defName="HRK_Type99ArisakaGL"]/verbs</xpath>
                    <value>
                        <verbs>
                            <li>
                                <verbClass>Verb_Shoot</verbClass>
                                <hasStandardCommand>true</hasStandardCommand>
                                <defaultProjectile>HRK_Bullet_Type99Arisaka</defaultProjectile>
                                <warmupTime>1.7</warmupTime>
                                <range>39</range>
                                <soundCast>HRK_Shot_Type99Rifle</soundCast>
                                <soundCastTail>GunTail_Heavy</soundCastTail>
                                <muzzleFlashScale>9</muzzleFlashScale>
                                <commandIcon>UI/Gizmos/HRK_Gizmo_Type99Bullet</commandIcon>
                                <label>Type 99 Arisaka</label>
                            </li>
                            <li>
                                <verbClass>Verb_Shoot</verbClass>
                                <hasStandardCommand>true</hasStandardCommand>
                                <defaultProjectile>HRK_Bullet_Type99ArisakaGL</defaultProjectile>
                                <ai_AvoidFriendlyFireRadius>5</ai_AvoidFriendlyFireRadius>
                                <ai_IsBuildingDestroyer>true</ai_IsBuildingDestroyer>
                                <warmupTime>3.5</warmupTime>
                                <range>24</range>
                                <forcedMissRadius>1.9</forcedMissRadius>
                                <burstShotCount>1</burstShotCount>
                                <soundCast>HRK_Shot_Type2RifleGrenade</soundCast>
                                <soundCastTail>GunTail_Medium</soundCastTail>
                                <muzzleFlashScale>14</muzzleFlashScale>
                                <targetParams>
                                    <canTargetLocations>true</canTargetLocations>
                                </targetParams>
                                <commandIcon>UI/Gizmos/HRK_Gizmo_Type2Grenade</commandIcon>
                                <label>Type 2 Grenade</label>
                            </li>
                        </verbs>
                    </value>
                </li>

                <li Class="PatchOperationAdd" MayRequire="OskarPotocki.VanillaFactionsExpanded.Core">
                    <xpath>Defs/ThingDef[defName="HRK_Type99ArisakaGL"]</xpath>
                    <value>
                        <comps>
                            <li Class="MVCF.Comps.CompProperties_VerbProps">
                                <compClass>MVCF.Comps.Comp_VerbProps</compClass>
                                <verbProps>
                                    <li>
                                        <label>Rifle</label>
                                        <canBeToggled>true</canBeToggled>
                                        <separateToggle>false</separateToggle>
                                    </li>
                                    <li>
                                        <label>Grenade</label>
                                        <canBeToggled>true</canBeToggled>
                                        <separateToggle>false</separateToggle>
                                    </li>
                                </verbProps>
                            </li>
                        </comps>
                    </value>
                </li>

                <li Class="PatchOperationReplace" MayRequire="OskarPotocki.VanillaFactionsExpanded.Core">
                    <xpath>Defs/ThingDef[defName="HRK_Type89GrenadeDischarger"]/verbs</xpath>
                    <value>
                        <verbs>
                            <li>
                                <verbClass>Verb_Shoot</verbClass>
                                <hasStandardCommand>true</hasStandardCommand>
                                <defaultProjectile>HRK_Bullet_Type89GrenadeDischarger_HE</defaultProjectile>
                                <warmupTime>2.5</warmupTime>
                                <ai_AvoidFriendlyFireRadius>5</ai_AvoidFriendlyFireRadius>
                                <ai_IsBuildingDestroyer>true</ai_IsBuildingDestroyer>
                                <range>18</range>
                                <forcedMissRadius>2.9</forcedMissRadius>
                                <burstShotCount>1</burstShotCount>
                                <soundCast>HRK_Shot_Type89GrenadeDischarger</soundCast>
                                <soundCastTail>GunTail_Medium</soundCastTail>
                                <muzzleFlashScale>14</muzzleFlashScale>
                                <targetParams>
                                    <canTargetLocations>true</canTargetLocations>
                                </targetParams>
                                <commandIcon>UI/Gizmos/HRK_Gizmo_Type89HE</commandIcon>
                                <label>Explosive</label>
                            </li>
                            <li>
                                <verbClass>Verb_Shoot</verbClass>
                                <hasStandardCommand>true</hasStandardCommand>
                                <defaultProjectile>HRK_Bullet_Type89GrenadeDischarger_Incendiary</defaultProjectile>
                                <warmupTime>2.5</warmupTime>
                                <ai_AvoidFriendlyFireRadius>5</ai_AvoidFriendlyFireRadius>
                                <range>18</range>
                                <forcedMissRadius>2.9</forcedMissRadius>
                                <burstShotCount>1</burstShotCount>
                                <soundCast>HRK_Shot_Type89GrenadeDischarger</soundCast>
                                <soundCastTail>GunTail_Medium</soundCastTail>
                                <muzzleFlashScale>14</muzzleFlashScale>
                                <targetParams>
                                    <canTargetLocations>true</canTargetLocations>
                                </targetParams>
                                <commandIcon>UI/Gizmos/HRK_Gizmo_Type89Incendiary</commandIcon>
                                <label>Incendiary</label>
                            </li>
                            <li>
                                <verbClass>Verb_Shoot</verbClass>
                                <hasStandardCommand>true</hasStandardCommand>
                                <defaultProjectile>HRK_Bullet_Type89GrenadeDischarger_SMK</defaultProjectile>
                                <warmupTime>2.5</warmupTime>
                                <range>18</range>
                                <forcedMissRadius>2.9</forcedMissRadius>
                                <burstShotCount>1</burstShotCount>
                                <soundCast>HRK_Shot_Type89GrenadeDischarger</soundCast>
                                <soundCastTail>GunTail_Medium</soundCastTail>
                                <muzzleFlashScale>14</muzzleFlashScale>
                                <targetParams>
                                    <canTargetLocations>true</canTargetLocations>
                                </targetParams>
                                <commandIcon>UI/Gizmos/HRK_Gizmo_Type89SMK</commandIcon>
                                <label>Smoke</label>
                            </li>
                        </verbs>
                    </value>
                </li>

                <li Class="PatchOperationAdd" MayRequire="OskarPotocki.VanillaFactionsExpanded.Core">
                    <xpath>Defs/ThingDef[defName="HRK_Type89GrenadeDischarger"]</xpath>
                    <value>
                        <comps>
                            <li Class="MVCF.Comps.CompProperties_VerbProps">
                                <compClass>MVCF.Comps.Comp_VerbProps</compClass>
                                <verbProps>
                                    <li>
                                        <label>Explosive</label>
                                        <canBeToggled>true</canBeToggled>
                                        <separateToggle>false</separateToggle>
                                    </li>
                                    <li>
                                        <label>Incendiary</label>
                                        <canBeToggled>true</canBeToggled>
                                        <separateToggle>false</separateToggle>
                                    </li>
                                    <li>
                                        <label>Smoke</label>
                                        <canBeToggled>true</canBeToggled>
                                        <separateToggle>false</separateToggle>
                                    </li>
                                </verbProps>
                            </li>
                        </comps>
                    </value>
                </li>

            </operations>
        </nomatch>
    </Operation>

</Patch>        